# Copilot Development Environment
#
# This docker-compose file creates a safe, containerized environment for
# running AI agents with full autonomy.
#
# Usage:
#   1. Copy .env.example to .env and configure
#   2. docker compose up -d
#   3. docker compose exec ai-env bash

services:
  ai-env-cp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ai-env-cp

    # Keep container running for exec access
    stdin_open: true
    tty: true

    # Mount workspace from host - set WORKSPACE env var or use default
    volumes:
      # Mounts prompts globally so they can be referenced everywhere
      - C:\Users\Adam\Desktop\workspace\agentic-prompts\.copilot:/root/.copilot
      # Path to target project directory -> the directory path where you want your agent to do work
      - C:\Users\Adam\Desktop\workspace\react-sample-app\:/workspace
      # Mount git config from host for commits
      - ~/.gitconfig:/root/.gitconfig:ro
      # Persist data between sessions (bash history, etc.)
      - ai-env-persist:/root/.persist

    # Working directory inside container
    working_dir: /workspace
    env_file:
      - ./.env
    # Environment variables
    environment:
      # Ensure proper terminal behavior
      - TERM=xterm-256color
      # NVM setup
      - NVM_DIR=/root/.nvm
      # Persist bash history to volume
      - HISTFILE=/root/.persist/.bash_history

    # Full network access for package installation and API calls
    network_mode: bridge

    # Resource limits (configure in .env)
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 512M

    # Restart policy - keeps ralph running
    restart: unless-stopped

volumes:
  ai-env-persist:
    name: ai-env-persist
